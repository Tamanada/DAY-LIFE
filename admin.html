<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DAYLIFE â€” Admin Console (local)</title>
  <link rel="stylesheet" href="assets/style.css" />
</head>
<body>
  <!-- Top bar -->
  <header class="topbar">
    <div class="logo">
      <img src="assets/logo.png" alt="DAYLIFE Logo" />
      <span>DAYLIFE</span>
    </div>
    <nav class="desktop-nav">
      <a href="home.html">ğŸ  Home</a>
      <a href="dreams.html">ğŸ’­ Dreams</a>
      <a href="reflections.html">ğŸª Reflections</a>
      <a href="profile.html">ğŸ‘¤ Profile</a>
      <!-- Pas de lien visible vers lâ€™admin si tu veux le garder â€œsecretâ€ -->
    </nav>
  </header>

  <main class="admin-page">
    <section class="admin-card admin-header">
      <h1>DAYLIFE â€” Console locale</h1>
      <p>
        Cette page te permet de voir et modifier <strong>les donnÃ©es stockÃ©es dans ce navigateur</strong>
        (profil, rÃªves, rÃ©flexions). IdÃ©al pour tester, corriger, ou faire des backups.
      </p>
      <p class="admin-warning">
        âš ï¸ Tout ce que tu modifies ici n'affecte que <strong>cet appareil / ce navigateur</strong>.
        Aucun serveur n'est impliquÃ©.
      </p>

      <div class="admin-summary" id="adminSummary"></div>

      <div class="admin-actions">
        <button id="exportBtn" class="primary-btn">ğŸ“¤ Exporter toutes les donnÃ©es (JSON)</button>
        <label class="file-btn">
          ğŸ“¥ Importer des donnÃ©es (JSON)
          <input type="file" id="importInput" accept="application/json" hidden />
        </label>
        <button id="resetBtn" class="danger-btn">ğŸ§¨ Reset complet (localStorage)</button>
      </div>
    </section>

    <!-- Profil -->
    <section class="admin-card">
      <h2>Profil (clÃ© : <code>profile</code>)</h2>
      <p class="small">
        Tu peux Ã©diter directement lâ€™objet JSON. Ex :
        <code>{"name":"David","totalStars":25,"streakDays":7,...}</code>
      </p>
      <textarea id="profileJson" class="admin-textarea" spellcheck="false"></textarea>
      <div class="admin-actions-row">
        <button id="saveProfileBtn" class="primary-btn">ğŸ’¾ Sauvegarder le profil</button>
        <a href="profile.html" class="link-btn" target="_blank">ğŸ‘€ Ouvrir la page Profile</a>
      </div>
    </section>

    <!-- RÃªves -->
    <section class="admin-card">
      <h2>RÃªves (clÃ© : <code>dreams</code>)</h2>
      <p class="small">
        Tableau dâ€™objets. Tu peux ajouter, supprimer ou modifier des rÃªves Ã  la main.
      </p>
      <textarea id="dreamsJson" class="admin-textarea" spellcheck="false"></textarea>
      <div class="admin-actions-row">
        <button id="saveDreamsBtn" class="primary-btn">ğŸ’¾ Sauvegarder les rÃªves</button>
        <a href="dreams.html" class="link-btn" target="_blank">ğŸ‘€ Ouvrir la page Dreams</a>
      </div>
    </section>

    <!-- RÃ©flexions -->
    <section class="admin-card">
      <h2>RÃ©flexions (clÃ© : <code>reflections</code>)</h2>
      <p class="small">
        Tableau dâ€™objets (une entrÃ©e par rÃ©flexion). Tu peux corriger ou importer un journal complet.
      </p>
      <textarea id="reflectionsJson" class="admin-textarea" spellcheck="false"></textarea>
      <div class="admin-actions-row">
        <button id="saveReflectionsBtn" class="primary-btn">ğŸ’¾ Sauvegarder les rÃ©flexions</button>
        <a href="reflections.html" class="link-btn" target="_blank">ğŸ‘€ Ouvrir la page Reflections</a>
      </div>
    </section>
  </main>

  <!-- Pas de nav mobile en bas pour lâ€™admin (optionnel) -->

  <script>
    // --- Utilitaires JSON sÃ»rs ---
    function safeParse(text, fallback) {
      try {
        return JSON.parse(text);
      } catch (e) {
        console.error("JSON parse error:", e);
        return fallback;
      }
    }

    function pretty(value) {
      return JSON.stringify(value, null, 2);
    }

    // --- Chargement des donnÃ©es depuis localStorage ---
    function loadData() {
      const profile = safeParse(localStorage.getItem("profile") || "null", null);
      const dreams = safeParse(localStorage.getItem("dreams") || "[]", []);
      const reflections = safeParse(localStorage.getItem("reflections") || "[]", []);

      // Remplir les textareas
      document.getElementById("profileJson").value = profile ? pretty(profile) : "";
      document.getElementById("dreamsJson").value = pretty(dreams);
      document.getElementById("reflectionsJson").value = pretty(reflections);

      // RÃ©sumÃ© en haut
      const summary = document.getElementById("adminSummary");
      const name = profile && profile.name ? profile.name : "Inconnu";
      const stars = profile && profile.totalStars ? profile.totalStars : 0;
      const streak = profile && profile.streakDays ? profile.streakDays : 0;

      summary.innerHTML = `
        <div class="admin-summary-grid">
          <div>
            <div class="label">Nom</div>
            <div class="value">${name}</div>
          </div>
          <div>
            <div class="label">Ã‰toiles</div>
            <div class="value">â­ ${stars}</div>
          </div>
          <div>
            <div class="label">Streak</div>
            <div class="value">ğŸ”¥ ${streak} jours</div>
          </div>
          <div>
            <div class="label">RÃªves</div>
            <div class="value">${dreams.length}</div>
          </div>
          <div>
            <div class="label">RÃ©flexions</div>
            <div class="value">${reflections.length}</div>
          </div>
          <div>
            <div class="label">ClÃ©s localStorage</div>
            <div class="value">${Object.keys(localStorage).length}</div>
          </div>
        </div>
      `;
    }

    // --- Sauvegardes ---
    function saveKeyFromTextarea(key, textareaId) {
      const raw = document.getElementById(textareaId).value.trim();
      if (!raw) {
        if (!confirm("Le contenu est vide. Supprimer la clÃ© '" + key + "' du localStorage ?")) {
          return;
        }
        localStorage.removeItem(key);
        alert("ClÃ© '" + key + "' supprimÃ©e.");
        loadData();
        return;
      }
      try {
        const parsed = JSON.parse(raw);
        localStorage.setItem(key, JSON.stringify(parsed));
        alert("DonnÃ©es sauvegardÃ©es pour '" + key + "'.");
        loadData();
      } catch (e) {
        alert("Erreur JSON : " + e.message);
      }
    }

    // --- Export complet ---
    function exportAll() {
      const data = {
        profile: safeParse(localStorage.getItem("profile") || "null", null),
        dreams: safeParse(localStorage.getItem("dreams") || "[]", []),
        reflections: safeParse(localStorage.getItem("reflections") || "[]", [])
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "daylife-backup.json";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // --- Import complet ---
    function importAll(file) {
      const reader = new FileReader();
      reader.onload = () => {
        try {
          const data = JSON.parse(reader.result);
          if (data.profile !== undefined) {
            localStorage.setItem("profile", JSON.stringify(data.profile));
          }
          if (data.dreams !== undefined) {
            localStorage.setItem("dreams", JSON.stringify(data.dreams));
          }
          if (data.reflections !== undefined) {
            localStorage.setItem("reflections", JSON.stringify(data.reflections));
          }
          alert("Import terminÃ© !");
          loadData();
        } catch (e) {
          alert("Fichier invalide : " + e.message);
        }
      };
      reader.readAsText(file);
    }

    // --- Reset complet ---
    function resetAll() {
      if (confirm("âš ï¸ Cela va effacer TOUT le localStorage pour ce domaine. Continuer ?")) {
        localStorage.clear();
        alert("localStorage vidÃ©. Tu peux maintenant recharger la page.");
        loadData();
      }
    }

    // --- Wiring des boutons ---
    document.getElementById("saveProfileBtn").addEventListener("click", () => {
      saveKeyFromTextarea("profile", "profileJson");
    });
    document.getElementById("saveDreamsBtn").addEventListener("click", () => {
      saveKeyFromTextarea("dreams", "dreamsJson");
    });
    document.getElementById("saveReflectionsBtn").addEventListener("click", () => {
      saveKeyFromTextarea("reflections", "reflectionsJson");
    });

    document.getElementById("exportBtn").addEventListener("click", exportAll);
    document.getElementById("resetBtn").addEventListener("click", resetAll);

    document.getElementById("importInput").addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) importAll(file);
      e.target.value = "";
    });

    document.querySelector(".file-btn").addEventListener("click", () => {
      document.getElementById("importInput").click();
    });

    // Initial load
    loadData();
  </script>
</body>
</html>
